# GoExercises - Что здесь

В этом проекте я держу разные тесты/упражнения и тп по Go
ЗЫ. Может кому будет интересно :-)

## Hash-функции: KeyHash, HashMap, HashFnv
- KeyHash функция была найдена на просторах инета цать лет назад, когда обнаружил, что hash функция в C++ STL дает очень плохой результат для разделения на шарды. Я тогда потестирвал несколько рекомендованных функций, эта показала наилучший реузльтат в плане баланса ключей между шардами.
- HashFnv и HashMap - рекомендованные функции для использования

Написал тестовую функцию и оказалось, что KeyHash и HashFnv это одна и таже функция! Неожиданно :-) HashMap дает худший баланс ключей по шардам.
Вот результаты основного теста:
```
2026/02/28 18:04:17 Hasher | Keys pattern |  Keys  |Shards|KeysShard| Min, %|Min, unit| Avg, %|Avg, unit| Max, %|Max, unit| Keys in Shards
2026/02/28 18:04:17 -------+--------------+--------+------+---------+--------+---------+--------+---------+--------+---------+---------------------------------------------------------
2026/02/28 18:04:17 KeyHash|  key[<index>]|  100000|     8|    12500|  0.000|        1|  0.000|        2|  0.000|        4| [12501 12498 12497 12504 12498 12501 12504 12497]
2026/02/28 18:04:17 HashFnv|  key[<index>]|  100000|     8|    12500|  0.000|        1|  0.000|        2|  0.000|        4| [12501 12498 12497 12504 12498 12501 12504 12497]
2026/02/28 18:04:17 hashMap|  key[<index>]|  100000|     8|    12500|  0.000|        3|  0.007|       93|  0.018|      221| [12279 12639 12424 12575 12516 12425 12639 12503]
2026/02/28 18:04:17 KeyHash|  key[<index>]|  500000|     8|    62500|  0.000|        2|  0.000|        5|  0.000|        8| [62497 62502 62493 62508 62502 62497 62508 62493]
2026/02/28 18:04:17 HashFnv|  key[<index>]|  500000|     8|    62500|  0.000|        2|  0.000|        5|  0.000|        8| [62497 62502 62493 62508 62502 62497 62508 62493]
2026/02/28 18:04:17 hashMap|  key[<index>]|  500000|     8|    62500|  0.001|       36|  0.003|      187|  0.007|      409| [62193 62464 62600 62417 62350 62327 62909 62740]
2026/02/28 18:04:17 KeyHash|  key[<index>]| 1000000|     8|   125000|  0.000|        1|  0.000|        3|  0.000|        6| [125001 124998 124995 125006 124998 125001 125006 124995]
2026/02/28 18:04:18 HashFnv|  key[<index>]| 1000000|     8|   125000|  0.000|        1|  0.000|        3|  0.000|        6| [125001 124998 124995 125006 124998 125001 125006 124995]
2026/02/28 18:04:18 hashMap|  key[<index>]| 1000000|     8|   125000|  0.000|       24|  0.003|      315|  0.005|      625| [124375 125606 125199 124976 124909 124477 125379 125079]
2026/02/28 18:04:18 KeyHash|  key[<index>]|  100000|    16|     6250|  0.000|        1|  0.003|       21|  0.006|       40| [6211 6251 6229 6275 6247 6211 6275 6268 6290 6247 6268 6229 6251 6290 6229 6229]
2026/02/28 18:04:18 HashFnv|  key[<index>]|  100000|    16|     6250|  0.000|        1|  0.003|       21|  0.006|       40| [6211 6251 6229 6275 6247 6211 6275 6268 6290 6247 6268 6229 6251 6290 6229 6229]
2026/02/28 18:04:18 hashMap|  key[<index>]|  100000|    16|     6250|  0.002|       11|  0.011|       66|  0.030|      190| [6167 6199 6207 6361 6277 6294 6367 6229 6112 6440 6217 6214 6239 6131 6272 6274]
2026/02/28 18:04:18 KeyHash|  key[<index>]|  500000|    16|    31250|  0.000|        7|  0.001|       43|  0.002|       77| [31173 31259 31203 31301 31243 31173 31301 31290 31324 31243 31290 31207 31259 31324 31207 31203]
2026/02/28 18:04:18 HashFnv|  key[<index>]|  500000|    16|    31250|  0.000|        7|  0.001|       43|  0.002|       77| [31173 31259 31203 31301 31243 31173 31301 31290 31324 31243 31290 31207 31259 31324 31207 31203]
2026/02/28 18:04:18 hashMap|  key[<index>]|  500000|    16|    31250|  0.000|        4|  0.004|      124|  0.010|      326| [31072 31255 31254 31493 31192 31212 31402 31339 31121 31209 31346 30924 31158 31115 31507 31401]
2026/02/28 18:04:18 KeyHash|  key[<index>]| 1000000|    16|    62500|  0.000|       13|  0.001|       54|  0.002|       94| [62407 62513 62442 62559 62485 62407 62559 62553 62594 62485 62553 62447 62513 62594 62447 62442]
2026/02/28 18:04:18 HashFnv|  key[<index>]| 1000000|    16|    62500|  0.000|       13|  0.001|       54|  0.002|       94| [62407 62513 62442 62559 62485 62407 62559 62553 62594 62485 62553 62447 62513 62594 62447 62442]
2026/02/28 18:04:18 hashMap|  key[<index>]| 1000000|    16|    62500|  0.000|        1|  0.003|      217|  0.006|      393| [62107 62828 62700 62744 62728 62272 62595 62581 62268 62778 62499 62232 62181 62205 62784 62498]
2026/02/28 18:04:18 KeyHash|        <uuid>|  100000|     8|    12500|  0.002|       22|  0.005|       59|  0.007|       83| [12432 12446 12522 12575 12583 12556 12431 12455]
2026/02/28 18:04:18 HashFnv|        <uuid>|  100000|     8|    12500|  0.002|       22|  0.005|       59|  0.007|       83| [12432 12446 12522 12575 12583 12556 12431 12455]
2026/02/28 18:04:18 hashMap|        <uuid>|  100000|     8|    12500|  0.006|       75|  0.009|      116|  0.021|      263| [12425 12425 12763 12591 12610 12417 12371 12398]
2026/02/28 18:04:18 KeyHash|        <uuid>|  500000|     8|    62500|  0.000|       19|  0.003|      172|  0.006|      378| [62122 62724 62401 62544 62519 62646 62288 62756]
2026/02/28 18:04:18 HashFnv|        <uuid>|  500000|     8|    62500|  0.000|       19|  0.003|      172|  0.006|      378| [62122 62724 62401 62544 62519 62646 62288 62756]
2026/02/28 18:04:18 hashMap|        <uuid>|  500000|     8|    62500|  0.001|       51|  0.004|      223|  0.006|      376| [62825 62124 62629 62551 62834 62206 62276 62555]
2026/02/28 18:04:18 KeyHash|        <uuid>| 1000000|     8|   125000|  0.001|       82|  0.001|      139|  0.002|      245| [124755 124905 125176 124864 125127 125161 124918 125094]
2026/02/28 18:04:18 HashFnv|        <uuid>| 1000000|     8|   125000|  0.001|       82|  0.001|      139|  0.002|      245| [124755 124905 125176 124864 125127 125161 124918 125094]
2026/02/28 18:04:18 hashMap|        <uuid>| 1000000|     8|   125000|  0.000|       11|  0.001|      185|  0.004|      456| [125285 124935 124969 124631 125456 124978 124989 124757]
2026/02/28 18:04:18 KeyHash|        <uuid>|  100000|    16|     6250|  0.001|        7|  0.007|       41|  0.019|      120| [6243 6218 6300 6260 6370 6225 6199 6257 6189 6228 6222 6315 6213 6331 6232 6198]
2026/02/28 18:04:18 HashFnv|        <uuid>|  100000|    16|     6250|  0.001|        7|  0.007|       41|  0.019|      120| [6243 6218 6300 6260 6370 6225 6199 6257 6189 6228 6222 6315 6213 6331 6232 6198]
2026/02/28 18:04:18 hashMap|        <uuid>|  100000|    16|     6250|  0.001|        5|  0.010|       62|  0.022|      137| [6283 6206 6376 6258 6265 6203 6116 6176 6142 6219 6387 6333 6345 6214 6255 6222]
2026/02/28 18:04:18 hashMap|        <uuid>|  500000|    16|    31250|  0.002|       64|  0.005|      144|  0.009|      279| [31474 30971 31443 31415 31388 31129 31103 31168 31351 31153 31186 31136 31446 31077 31173 31387]
2026/02/28 18:04:18 KeyHash|        <uuid>|  500000|    16|    31250|  0.001|       21|  0.005|      156|  0.012|      370| [31020 31453 31180 31138 31438 31081 31171 31620 31102 31271 31221 31406 31081 31565 31117 31136]
2026/02/28 18:04:18 HashFnv|        <uuid>|  500000|    16|    31250|  0.001|       21|  0.005|      156|  0.012|      370| [31020 31453 31180 31138 31438 31081 31171 31620 31102 31271 31221 31406 31081 31565 31117 31136]
2026/02/28 18:04:18 KeyHash|        <uuid>| 1000000|    16|    62500|  0.000|        3|  0.002|      149|  0.006|      348| [62219 62589 62545 62169 62630 62313 62435 62724 62536 62316 62631 62695 62497 62848 62483 62370]
2026/02/28 18:04:18 HashFnv|        <uuid>| 1000000|    16|    62500|  0.000|        3|  0.002|      149|  0.006|      348| [62219 62589 62545 62169 62630 62313 62435 62724 62536 62316 62631 62695 62497 62848 62483 62370]
2026/02/28 18:04:18 hashMap|        <uuid>| 1000000|    16|    62500|  0.000|        2|  0.003|      198|  0.009|      569| [62672 62324 62765 62357 62672 62498 62347 61931 62613 62611 62204 62274 62784 62480 62642 62826]
2026/02/28 18:04:18 hashMap|     <uuid.v7>|  100000|     8|    12500|  0.000|        5|  0.005|       65|  0.010|      131| [12495 12530 12429 12443 12578 12372 12631 12522]
2026/02/28 18:04:18 KeyHash|     <uuid.v7>|  100000|     8|    12500|  0.002|       24|  0.007|       91|  0.016|      199| [12470 12524 12422 12443 12530 12301 12676 12634]
2026/02/28 18:04:18 HashFnv|     <uuid.v7>|  100000|     8|    12500|  0.002|       24|  0.007|       91|  0.016|      199| [12470 12524 12422 12443 12530 12301 12676 12634]
2026/02/28 18:04:18 KeyHash|     <uuid.v7>|  500000|     8|    62500|  0.000|       20|  0.002|      152|  0.005|      304| [62413 62803 62648 62639 62353 62428 62520 62196]
2026/02/28 18:04:18 HashFnv|     <uuid.v7>|  500000|     8|    62500|  0.000|       20|  0.002|      152|  0.005|      304| [62413 62803 62648 62639 62353 62428 62520 62196]
2026/02/28 18:04:18 hashMap|     <uuid.v7>|  500000|     8|    62500|  0.000|       22|  0.002|      156|  0.006|      396| [62415 62631 62331 62317 62896 62478 62600 62332]
2026/02/28 18:04:19 KeyHash|     <uuid.v7>| 1000000|     8|   125000|  0.000|        0|  0.001|       94|  0.002|      280| [124997 125096 124895 125280 124920 125000 124855 124957]
2026/02/28 18:04:19 HashFnv|     <uuid.v7>| 1000000|     8|   125000|  0.000|        0|  0.001|       94|  0.002|      280| [124997 125096 124895 125280 124920 125000 124855 124957]
2026/02/28 18:04:19 hashMap|     <uuid.v7>| 1000000|     8|   125000|  0.001|       71|  0.002|      281|  0.004|      554| [125434 125119 124740 124688 125292 125210 124446 125071]
2026/02/28 18:04:19 KeyHash|     <uuid.v7>|  100000|    16|     6250|  0.001|        6|  0.011|       68|  0.022|      140| [6229 6268 6312 6332 6213 6131 6325 6356 6241 6256 6110 6111 6317 6170 6351 6278]
2026/02/28 18:04:19 HashFnv|     <uuid.v7>|  100000|    16|     6250|  0.001|        6|  0.011|       68|  0.022|      140| [6229 6268 6312 6332 6213 6131 6325 6356 6241 6256 6110 6111 6317 6170 6351 6278]
2026/02/28 18:04:19 hashMap|     <uuid.v7>|  100000|    16|     6250|  0.000|        3|  0.008|       50|  0.019|      120| [6304 6304 6186 6196 6361 6130 6288 6304 6191 6226 6243 6247 6217 6242 6343 6218]
2026/02/28 18:04:19 KeyHash|     <uuid.v7>|  500000|    16|    31250|  0.000|        5|  0.004|      125|  0.013|      413| [31324 31448 31663 31382 31075 31183 31298 31048 31089 31355 30985 31257 31278 31245 31222 31148]
2026/02/28 18:04:19 HashFnv|     <uuid.v7>|  500000|    16|    31250|  0.000|        5|  0.004|      125|  0.013|      413| [31324 31448 31663 31382 31075 31183 31298 31048 31089 31355 30985 31257 31278 31245 31222 31148]
2026/02/28 18:04:19 hashMap|     <uuid.v7>|  500000|    16|    31250|  0.000|       14|  0.004|      127|  0.009|      282| [31366 31236 31047 30993 31364 31071 31277 31206 31049 31395 31284 31324 31532 31407 31323 31126]
2026/02/28 18:04:19 HashFnv|     <uuid.v7>| 1000000|    16|    62500|  0.000|        4|  0.002|      119|  0.005|      327| [62516 62726 62671 62827 62306 62569 62528 62453 62481 62370 62224 62453 62614 62431 62327 62504]
2026/02/28 18:04:19 hashMap|     <uuid.v7>| 1000000|    16|    62500|  0.000|       17|  0.003|      191|  0.006|      392| [62695 62300 62108 62133 62564 62573 62265 62588 62739 62819 62632 62555 62728 62637 62181 62483]
2026/02/28 18:04:19 KeyHash|     <uuid.v7>| 1000000|    16|    62500|  0.000|        4|  0.002|      119|  0.005|      327| [62516 62726 62671 62827 62306 62569 62528 62453 62481 62370 62224 62453 62614 62431 62327 62504]
```

Вот результаты бенчмаркинга на моем ноуте:
```
goos: linux (Ubuntu 22.04, go1.24.0)
goarch: amd64
cpu: Intel(R) Core(TM) i7-14700HX

BenchmarkKeyHashBasicSeq-28    	1000000000	         1.072 ns/op	       0 B/op	       0 allocs/op
BenchmarkHashFnvBasicSeq-28    	407061147	         2.940 ns/op	       0 B/op	       0 allocs/op
BenchmarkHashMapBasicSeq-28    	342528536	         3.436 ns/op	       0 B/op	       0 allocs/op
BenchmarkKeyHashUUIDSeq-28    	216890671	         5.771 ns/op	       0 B/op	       0 allocs/op
BenchmarkHashFnvUUIDSeq-28    	60129084 	         18.34 ns/op	       0 B/op	       0 allocs/op
BenchmarkHashMapUUIDSeq-28    	263466603	         4.493 ns/op	       0 B/op	       0 allocs/op
```

## Testcontainers
Разные эксперименты с testcontainers
- redis_test - запуск редиса в докере и проверка базовых функций
